#!/usr/bin/env bash
# Pre-commit hook that delegates to Make targets for consistency.
# Runs project-wide format, then re-stages, then lint.

set -euo pipefail

repo_root=$(git rev-parse --show-toplevel)
cd "$repo_root"

# Nothing staged? quit early
if [[ -z $(git diff --cached --name-only --diff-filter=ACMR) ]]; then
  exit 0
fi

echo "[pre-commit] make format"
make format

echo "[pre-commit] make lint"
make lint

# Re-stage any changes after formatting
git add -A

exit 0
